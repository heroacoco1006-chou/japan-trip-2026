<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÁÄ®Êà∂ÂÖßÊµ∑‰πãÊóÖ">
    <title>Êó•Êú¨ÊùæÂ±±Âª£Â≥∂‰πãÊóÖ</title>
    
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ÂºïÂÖ• Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; touch-action: pan-y; }
        /* Â¢ûÂä†ÈªûÊìäÂçÄÂüüÁöÑË¶ñË¶∫ÂõûÈ•ã */
        .tap-active:active { transform: scale(0.98); opacity: 0.8; }
    </style>
</head>
<body class="bg-[#FFFBF5]">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Plane, Car, MapPin, Utensils, Bed, Calendar, Sun, Cloud, 
            CloudRain, Ship, Coffee, Camera, Clock, Info, Image as ImageIcon, 
            Wifi, Navigation, ExternalLink, Banknote, Timer, Fuel
        } from 'lucide-react';

        // --- Ë≥áÊñôË®≠ÂÆöÂçÄ ---

        const weatherData = {
            1: { temp: '6¬∞C - 11¬∞C', condition: 'sunny', desc: 'Êô¥ÊúóÔºåÊµ∑È¢®Á®çÂ§ß (Ê≠∑Âè≤Âπ≥Âùá)' },
            2: { temp: '5¬∞C - 10¬∞C', condition: 'cloudy', desc: 'Â§öÈõ≤ÔºåÈÅ©ÂêàÊ≠•Ë°å (Ê≠∑Âè≤Âπ≥Âùá)' },
            3: { temp: '4¬∞C - 9¬∞C', condition: 'rain', desc: 'ÂÅ∂ÊúâÂ∞èÈõ®ÔºåÂ∏∂ÂÇò (Ê≠∑Âè≤Âπ≥Âùá)' },
            4: { temp: '3¬∞C - 8¬∞C', condition: 'sunny', desc: 'Êô¥ÊúóÔºåÂÆÆÂ≥∂Â§ïÈôΩÁæé (Ê≠∑Âè≤Âπ≥Âùá)' },
            5: { temp: '4¬∞C - 10¬∞C', condition: 'cloudy', desc: 'Â§öÈõ≤ËΩâÊô¥ (Ê≠∑Âè≤Âπ≥Âùá)' },
            6: { temp: '5¬∞C - 11¬∞C', condition: 'sunny', desc: 'Êµ∑Ë±°Âπ≥Á©© (Ê≠∑Âè≤Âπ≥Âùá)' },
            7: { temp: '6¬∞C - 12¬∞C', condition: 'sunny', desc: 'Ê∫´ÊöñËàíÈÅ© (Ê≠∑Âè≤Âπ≥Âùá)' },
            8: { temp: '5¬∞C - 11¬∞C', condition: 'cloudy', desc: 'ÂõûÁ®ãÈ†ÜÂà© (Ê≠∑Âè≤Âπ≥Âùá)' },
        };

        const getWikiImage = (filename) => `https://commons.wikimedia.org/wiki/Special:FilePath/${filename}`;

        // Ë°åÁ®ãË≥áÊñô (ÂåÖÂê´ Map ÈÄ£ÁµêËàá‰∫§ÈÄöË≥áË®ä)
        const itinerary = [
          {
            day: 1,
            date: '01/15',
            displayDate: '01/15 (Âõõ)',
            location: 'ÊÑõÂ™õÊùæÂ±± -> Â∞æÈÅì',
            lat: 34.4063, lng: 133.1950,
            summary: 'ÁÄ®Êà∂ÂÖßÊµ∑Ëá™ÈßïÈñãÂßãÔºöÁ©øË∂äÂ≥∂Ê≥¢Êµ∑ÈÅì',
            color: 'from-orange-400 to-pink-500',
            schedule: [
              { time: '09:50', type: 'flight', title: 'ÊäµÈÅîÊùæÂ±±Ê©üÂ†¥', sub: 'EVA Air BR 110', icon: Plane, imgUrl: getWikiImage('Matsuyama_Airport_(MYJ)_2.jpg') },
              { time: '11:00', type: 'transport', title: 'ORIX Rent-a-car ÊùæÂ±±Ê©üÂ†¥Â∫ó', sub: 'ÂèñËªäÂá∫Áôº', icon: Car, mapUrl: 'https://maps.app.goo.gl/de2afwf5cNgs9k7Y9' },
              { 
                time: '11:30', type: 'move', title: 'ÂâçÂæÄ‰æÜÂ≥∂Êµ∑Â≥Ω', 
                icon: Car, 
                transport: { dist: '55km', time: '1Â∞èÊôÇ', cost: '¬•2,500 (ETC)' }
              },
              { time: '12:30', type: 'food', title: '‰æÜÂ≥∂Êµ∑Â≥Ω SA', sub: 'ÂçàÈ§ê & ËßÄË≥ûÂ§ßÊ©ã', img: '‰æÜÂ≥∂Êµ∑Â≥ΩÂ§ßÊ©ã', imgUrl: 'https://duk.tw/hkinyW.jpg', note: 'Êé®Ëñ¶ÔºöÁáíË±öÁéâÂ≠êÈ£Ø', icon: Utensils, mapUrl: 'https://maps.app.goo.gl/md3g8vHEFbCmfiUu9' },
              { 
                time: '13:30', type: 'move', title: 'ÂâçÂæÄÂ∞æÈÅì', 
                icon: Car, 
                transport: { dist: '40km', time: '45ÂàÜ', cost: '¬•2,000 (ETC)' }
              },
              { time: '15:00', type: 'activity', title: 'ÂæåËó§È£≤ÊñôÊ∞¥Â∑•Ê•≠ÊâÄ', sub: 'Âæ©Âè§ÂΩàÁè†Ê±ΩÊ∞¥', img: 'ÂæåËó§È£≤Êñô', imgUrl: getWikiImage('Ramune_drink.jpg'), icon: Coffee, mapUrl: 'https://maps.app.goo.gl/81rmPxgdRiQFHST38' },
              { time: '16:00', type: 'activity', title: 'Â∞æÈÅìÊ≠•Ë°åË°ó', sub: 'Ë≤ì‰πãÁ¥∞ÈÅì„ÄÅÊï£Á≠ñ', img: 'Â∞æÈÅìÂïÜÂ∫óË°ó', imgUrl: getWikiImage('Onomichi.JPG'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/uig3md6VdNM9rEPm8' },
              { time: '18:30', type: 'food', title: 'Â∞æÈÅìÊãâÈ∫µ', sub: 'ÊôöÈ§ê', img: 'Â∞æÈÅìÊãâÈ∫µ', imgUrl: getWikiImage('Onomichi_ramen.jpg'), note: 'ËÉåËÑÇÈÜ¨Ê≤πÊπØÂ∫ï', icon: Utensils, mapUrl: 'https://maps.app.goo.gl/7nj5J4kvZTcXKGJt9' },
              { time: '20:00', type: 'hotel', title: '„Åï„Åè„Çâ„Åó„Åæ„Å™„Åø„Éõ„ÉÜ„É´', sub: 'Check-in', img: 'Â∞æÈÅìÈ£ØÂ∫ó', imgUrl: 'https://duk.tw/xZGZWI.jpg', icon: Bed, mapUrl: 'https://maps.app.goo.gl/n6zxBe1UCmc9FVTM7' },
            ]
          },
          {
            day: 2,
            date: '01/16',
            displayDate: '01/16 (‰∫î)',
            location: 'Â∞æÈÅì -> Âª£Â≥∂',
            lat: 34.3853, lng: 132.4553,
            summary: 'ÂçÉÂÖâÂØ∫ÂèÉÊãúËàáÂª£Â≥∂‰πãÂ§ú',
            color: 'from-blue-400 to-indigo-500',
            schedule: [
              { time: '09:00', type: 'activity', title: 'ÂçÉÂÖâÂØ∫Á∫úËªä', sub: 'Êê≠‰πòÁ∫úËªäÁôªÈ†Ç', img: 'ÂçÉÂÖâÂØ∫Á∫úËªä', imgUrl: getWikiImage('Onomichi_from_Senko-ji.jpg'), icon: Camera, mapUrl: 'https://maps.app.goo.gl/zUtW1uCPo2e9Mkb66' },
              { time: '10:00', type: 'activity', title: 'ÂçÉÂÖâÂØ∫', sub: 'ÂØ∫ÂªüÈÅäË¶Ω', icon: MapPin, mapUrl: 'https://maps.app.goo.gl/naUyQmmophfysFzH8' },
              { 
                time: '13:00', type: 'move', title: 'ÂâçÂæÄÂª£Â≥∂Â∏Ç', 
                icon: Car, 
                transport: { dist: '90km', time: '1Â∞èÊôÇ30ÂàÜ', cost: '¬•2,800 (ETC)' }
              },
              { time: '15:00', type: 'hotel', title: 'MYSTAYS Âª£Â≥∂ÂíåÂπ≥ÂÖ¨ÂúíÂâç', sub: 'Check-in ÊîæÁΩÆË°åÊùé', img: 'Âª£Â≥∂È£ØÂ∫ó', imgUrl: getWikiImage('Hiroshima_City_View.jpg'), icon: Bed, mapUrl: 'https://maps.app.goo.gl/9sVmPPKghe8faGh17' },
              { time: '16:30', type: 'activity', title: 'Âª£Â≥∂Â∏ÇÂçÄÈÄõË°ó', sub: 'Êú¨ÈÄöÂïÜÂ∫óË°ó', img: 'Âª£Â≥∂Êú¨ÈÄö', imgUrl: getWikiImage('Hondori_Hiroshima.jpg'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/xUxj9JAkKyc3JrkR9' },
            ]
          },
          {
            day: 3,
            date: '01/17',
            displayDate: '01/17 (ÂÖ≠)',
            location: 'Âª£Â≥∂Â∏ÇÂçÄ',
            lat: 34.3853, lng: 132.4553,
            summary: 'Ê≠∑Âè≤Â∑°Á¶ÆËàáÂª£Â≥∂Ááí',
            color: 'from-emerald-500 to-teal-600',
            schedule: [
              { time: '09:30', type: 'activity', title: 'ÂéüÁàÜÂúìÈ†ÇÈ§®', sub: '‰∏ñÁïåÈÅ∫Áî¢', img: 'ÂéüÁàÜÂúìÈ†ÇÈ§®', imgUrl: getWikiImage('Atomic_Bomb_Dome_-_panoramio.jpg'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/fM53zx9jzvXPHVQ5A' },
              { time: '10:30', type: 'activity', title: 'Âª£Â≥∂ÂíåÂπ≥Á¥ÄÂøµÂÖ¨Âúí', sub: 'ÂèÉËßÄË≥áÊñôÈ§®', icon: MapPin, mapUrl: 'https://maps.app.goo.gl/41Jj3hGHmx6yt6Vp6' },
              { time: '13:00', type: 'activity', title: 'ËàäÊó•Êú¨ÈäÄË°åÂª£Â≥∂ÂàÜÂ∫ó', sub: 'Ê≠∑Âè≤Âª∫ÁØâ', icon: MapPin, mapUrl: 'https://maps.app.goo.gl/TkCjn5BnDC9aCpSAA' },
              { time: '12:30', type: 'food', title: 'Èï∑Áî∞Â±ã Âª£Â≥∂Ááí', sub: '‰∫∫Ê∞£ÊéíÈöäÂêçÂ∫ó', img: 'Èï∑Áî∞Â±ãÂª£Â≥∂Ááí', imgUrl: getWikiImage('Okonomiyaki_in_Hiroshima_style_(5808057511).jpg'), note: 'Â§ßÈáèÁöÑËî•ËàáÁâπË£ΩÈÜ¨Ê±Å', icon: Utensils, mapUrl: 'https://maps.app.goo.gl/yQwduTUFMPbxqpwFA' },
              { time: '15:00', type: 'activity', title: 'Âª£Â≥∂Âüé', sub: 'ÈØâÈ≠öÂüé„ÄÅÂ§©ÂÆàÈñ£', img: 'Âª£Â≥∂Âüé', imgUrl: getWikiImage('Hiroshima_Castle.jpg'), icon: Camera, mapUrl: 'https://maps.app.goo.gl/Jc9o5HELipPwxiB16' },
              { time: '18:00', type: 'food', title: 'ÁÉ§Áâ°Ë†£Â∞èÂ±ã', sub: 'ÊôöÈ§ê', img: 'ÁÉ§Áâ°Ë†£', imgUrl: getWikiImage('Grilled_oysters_-_Food_in_Miyajima_-_DSC02187.JPG'), note: 'ÈÆÆÁæéÂ§öÊ±Å', icon: Utensils, mapUrl: 'https://maps.app.goo.gl/iZEWGCwXiFGXhcEx5' },
              { time: '20:00', type: 'hotel', title: 'MYSTAYS Âª£Â≥∂ÂíåÂπ≥ÂÖ¨ÂúíÂâç', sub: '‰ºëÊÅØ', icon: Bed, mapUrl: 'https://maps.app.goo.gl/SwCsHmMh6H6iq1AQ6' },
            ]
          },
          {
            day: 4,
            date: '01/18',
            displayDate: '01/18 (Êó•)',
            location: 'Âª£Â≥∂ -> ÂÆÆÂ≥∂',
            lat: 34.2960, lng: 132.3199,
            summary: 'Á•û‰πãÂ≥∂ËàáÊµ∑‰∏äÈ≥•Â±Ö',
            color: 'from-red-500 to-orange-500',
            schedule: [
              { 
                time: '09:00', type: 'move', title: 'ÂâçÂæÄÂÆÆÂ≥∂Âè£', 
                icon: Car, 
                transport: { dist: '22km', time: '45ÂàÜ', cost: '‰∏ÄËà¨ÈÅìË∑Ø' }
              },
              { time: '10:00', type: 'transport', title: 'ÂÆÆÂ≥∂Ê∏°Ëº™', sub: 'ÈÄ£Ëªä‰∏ÄÂêå‰∏äËàπ(Â¶ÇÈúÄ)ÊàñÂÅúËªä', icon: Ship, note: 'Ê∏°Ëº™Á¥Ñ10ÂàÜÈêò' },
              { time: '10:30', type: 'activity', title: 'ÂÆÆÂ≥∂ÂÅúËªäÂ†¥/Ê∏ØÂè£', sub: 'ÊäµÈÅîÂÆÆÂ≥∂', icon: Car, mapUrl: 'https://maps.app.goo.gl/jB88hazAqJdJgDtb8' },
              { time: '11:00', type: 'activity', title: 'ÂÆÆÂ≥∂Ë°®ÂèÉÈÅìÂïÜÂ∫óË°ó', sub: 'ÂçàÈ§êËàáÊï£Á≠ñ', img: 'ÂÆÆÂ≥∂ÂïÜÂ∫óË°ó', imgUrl: getWikiImage('Miyajima_Omotesando.jpg'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/UW8LPFCRpxuUmGDj8' },
              { time: '12:30', type: 'food', title: 'ÂÆÆÂ≥∂ÂïÜÂ∫óË°óÂçàÈ§ê', sub: 'Áâ°Ë†£„ÄÅÁ©¥Â≠êÈ£Ø', icon: Utensils, mapUrl: 'https://maps.app.goo.gl/PfTa2R2GShEBEvFV7' },
              { time: '15:00', type: 'hotel', title: 'ÂÆÆÂ≥∂ Á•ûÊí∞‰πãÂÆø Hotel Miya Rikyu', sub: 'Check-in', img: 'ÂÆÆÂ≥∂Ê∫´Ê≥âÈ£ØÂ∫ó', imgUrl: getWikiImage('Miyajima_ryokan.jpg'), note: '‰∫´ÂèóÊ∫´Ê≥âËàáÊá∑Áü≥ÊñôÁêÜ', icon: Bed, mapUrl: 'https://maps.app.goo.gl/V2qp3Z5nibtDVFFz9' },
            ]
          },
          {
            day: 5,
            date: '01/19',
            displayDate: '01/19 (‰∏Ä)',
            location: 'ÂÆÆÂ≥∂ -> Âê≥Â∏Ç',
            lat: 34.2483, lng: 132.5656,
            summary: 'Êµ∑ËªçÊ∏ØÂè£ËàáÊΩõÊ∞¥Ëâá',
            color: 'from-slate-600 to-slate-800',
            schedule: [
              { time: '09:00', type: 'activity', title: 'ÂÆÆÂ≥∂Á∫úËªä', sub: 'Á¥ÖËëâË∞∑ÂÖ¨ÂúíÁ´ô', img: 'ÂÆÆÂ≥∂Á∫úËªäÈ¢®ÊôØ', imgUrl: getWikiImage('Miyajima_View.jpg'), icon: Camera, mapUrl: 'https://maps.app.goo.gl/5GWo8PinVdC7Czmu6' },
              { 
                time: '13:00', type: 'move', title: 'ÂâçÂæÄÂê≥Â∏Ç', 
                icon: Car, 
                transport: { dist: '35km', time: '50ÂàÜ', cost: '¬•1,200 (ETC)' }
              },
              { time: '14:00', type: 'food', title: 'Êµ∑ËªçÂíñÂì©', sub: 'ÂçàÈ§ê', img: 'Êµ∑ËªçÂíñÂì©', imgUrl: getWikiImage('Curry_Japanese_Navy_Cookbook_1908.png'), icon: Utensils, mapUrl: 'https://maps.app.goo.gl/4aQSh5mByNnd6jWa9' },
              { time: '15:00', type: 'activity', title: 'ÊΩõÊ∞¥ËâáË≥áÊñôÈ§® (ÈêµÈØ®È§®)', sub: 'ÂèÉËßÄÁúüÂØ¶ÊΩõÊ∞¥Ëâá', img: 'ÈêµÈØ®È§®', imgUrl: getWikiImage('JMSDF_Kure_Museum.jpg'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/Pkwfhu8itWdhfJCDA' },
              { time: '17:00', type: 'activity', title: 'Âê≥ÁÅ£ËàπËâ¶Â∞éË¶Ω', sub: 'Â§ïÈôΩÁâàÂ∑°Ëà™', img: 'Âê≥Â∏ÇËªçËâ¶', imgUrl: getWikiImage('JMSDF_Kure_Base_E_wharf.jpg'), icon: Ship, mapUrl: 'https://maps.app.goo.gl/QhZWnArii7r6Hkkv6' },
              { time: '19:00', type: 'food', title: 'Âê≥Â∏ÇÂ±ãÂè∞ (Ëµ§ÊèêÁáà)', sub: 'ÊôöÈ§ê', img: 'Âê≥Â∏ÇÂ±ãÂè∞', imgUrl: getWikiImage('Oden_yatai.jpg'), icon: Utensils, mapUrl: 'https://maps.app.goo.gl/AyHPbnDdSw31kb8Z9' },
              { time: '20:30', type: 'hotel', title: 'Comfort Hotel Âê≥', sub: 'Check-in', img: 'Âê≥Â∏ÇÈ£ØÂ∫ó', imgUrl: getWikiImage('Kure_City_View.jpg'), icon: Bed, mapUrl: 'https://maps.app.goo.gl/4RN6j48GqbUT2kMb7' },
            ]
          },
          {
            day: 6,
            date: '01/20',
            displayDate: '01/20 (‰∫å)',
            location: 'Âê≥Â∏Ç -> ÊùæÂ±±',
            lat: 33.8392, lng: 132.7655,
            summary: 'Ê©´Ê∏°ÁÄ®Êà∂ÂÖßÊµ∑ËàáË≥ºÁâ©',
            color: 'from-cyan-500 to-blue-600',
            schedule: [
              { time: '09:00', type: 'transport', title: 'ÂâçÂæÄÂê≥Ê∏ØÁ¢ºÈ†≠', sub: 'Ê∫ñÂÇôÊê≠Ëàπ', icon: Car },
              { 
                time: '09:30', type: 'move', title: 'ÁÄ®Êà∂ÂÖßÊµ∑Ê±ΩËàπ (Âê≥->ÊùæÂ±±)', 
                icon: Ship, img: 'ÁÄ®Êà∂ÂÖßÊµ∑Ê±ΩËàπ', imgUrl: getWikiImage('Miyajima_Maru_ferry.jpg'), 
                mapUrl: 'https://setonaikaikisen.co.jp/',
                transport: { dist: 'Êµ∑Ë∑Ø', time: '1Â∞èÊôÇ55ÂàÜ', cost: 'ËªäËºõÁ¥Ñ¬•8000Ëµ∑ / ‰∫∫¬•3000Ëµ∑' }
              },
              { time: '12:00', type: 'activity', title: 'ÊÑõÂ™õÁ∏£Á´ãÁ†•ÈÉ®ÂãïÁâ©Âúí', sub: 'ËàáÁôΩÁÜäÂíåÂπ≥Áõ∏Ëôï', img: 'Á†•ÈÉ®ÂãïÁâ©Âúí', imgUrl: getWikiImage('Tobe_zoo2.jpg'), icon: Camera, mapUrl: 'https://maps.app.goo.gl/jNabnH9uG8qtJs1n6' },
              { time: '15:00', type: 'activity', title: 'Mont-bell ÊùæÂ±±Â∫ó', sub: 'Êà∂Â§ñÁî®ÂìÅÊé°Ë≥º', icon: MapPin, mapUrl: 'https://maps.app.goo.gl/NxLMmPHMksNZC7dM6' },
              { time: '16:40', type: 'transport', title: 'Âä†Ê≤πÁ´ô (SOLATO)', sub: 'ÈÇÑËªäÂâçÂä†ÊªøÊ≤π', icon: Fuel, mapUrl: 'https://maps.app.goo.gl/TY62BEYgfgDz3SiV6' },
              { time: '17:00', type: 'transport', title: 'ORIX Rent-a-car ÊùæÂ±±Â∫ó', sub: 'ÈÇÑËªä', icon: Car, mapUrl: 'https://maps.app.goo.gl/kd8nWcqqUqbBPxHc7', note: 'Ê™¢Êü•ÂÄã‰∫∫Áâ©ÂìÅ' },
              { time: '18:30', type: 'food', title: 'ÂÖÉÁ•ñ ÂÆáÂíåÂ≥∂ÈØõ„ÇÅ„Åó ‰∏∏Ê∞¥', sub: 'ÊôöÈ§êÔºöÈØõÈ≠öÈ£Ø', img: 'ÂÆáÂíåÂ≥∂ÈØõÈ≠öÈ£Ø', imgUrl: getWikiImage('Tai-meshi.jpg'), icon: Utensils, mapUrl: 'https://maps.app.goo.gl/bjx8oGK2Gv2L4zoe8' },
              { time: '20:00', type: 'hotel', title: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖßÈ£ØÂ∫ó', sub: 'Check-in', img: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖß', imgUrl: getWikiImage('Matsuyama_City_Station.jpg'), icon: Bed, mapUrl: 'https://maps.app.goo.gl/KbJXuTAp9eJrw72k6' },
            ]
          },
          {
            day: 7,
            date: '01/21',
            displayDate: '01/21 (‰∏â)',
            location: 'ÊùæÂ±±Â∏ÇÂçÄ',
            lat: 33.8392, lng: 132.7655,
            summary: 'Âè§ÂüéËàáÂçÉÂπ¥Ê∫´Ê≥â',
            color: 'from-orange-500 to-amber-500',
            schedule: [
              { time: '09:30', type: 'activity', title: 'ÊùæÂ±±Âüé', sub: 'Êê≠‰πòÁ∫úËªä/ÂêäÊ§Ö', img: 'ÊùæÂ±±Âüé', imgUrl: getWikiImage('Matsuyama_Castle_ÊùæÂ±±Âüé_-_panoramio_(3).jpg'), note: 'ÈñÄÁ•®+Á∫úËªäÁ¥Ñ¬•1040', icon: Camera, mapUrl: 'https://maps.app.goo.gl/3P2gHwUMnScLdRvr7' },
              { time: '12:00', type: 'food', title: 'ÊùæÂ±±ÈØõÈ≠öÈ£Ø', sub: 'ÂçàÈ§ê', img: 'ÈØõÈ≠öÈ£Ø', imgUrl: getWikiImage('Tai-meshi.jpg'), icon: Utensils },
              { time: '14:00', type: 'activity', title: 'ÈÅìÂæåÊ∫´Ê≥âÊú¨È§®', sub: 'Á•ûÈö±Â∞ëÂ•≥Â†¥ÊôØ', img: 'ÈÅìÂæåÊ∫´Ê≥â', imgUrl: getWikiImage('Dogo-onsen_Honkan.jpg'), icon: MapPin, mapUrl: 'https://maps.app.goo.gl/KyiqKEr22oCcY22t9' },
              { time: '15:30', type: 'activity', title: 'ÈÅìÂæåÂïÜÂ∫óË°ó', sub: 'Â∞ëÁà∫Ê©üÈóúÈêò', note: 'Ë∑ØÈù¢ÈõªËªäÂñÆÁ®ã¬•200', icon: MapPin },
              { time: '20:00', type: 'hotel', title: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖßÈ£ØÂ∫ó', sub: 'Êï¥ÁêÜË°åÊùé', icon: Bed, mapUrl: 'https://maps.app.goo.gl/3stse2uwm1Kay97L9' },
            ]
          },
          {
            day: 8,
            date: '01/22',
            displayDate: '01/22 (Âõõ)',
            location: 'ÊùæÂ±± -> Ê°ÉÂúí',
            lat: 33.8392, lng: 132.7655,
            summary: 'ÊªøËºâËÄåÊ≠∏',
            color: 'from-gray-500 to-gray-700',
            schedule: [
              { time: '08:30', type: 'hotel', title: 'Check-out', sub: 'È£ØÂ∫óÈÄÄÊàø', icon: Bed },
              { 
                time: '09:00', type: 'transport', title: 'ÂâçÂæÄÊùæÂ±±Ê©üÂ†¥', 
                icon: Car, 
                transport: { dist: 'Â∏ÇÂçÄ‰∫§ÈÄö', time: '30ÂàÜ', cost: 'Âà©Êú®Ê¥•Â∑¥Â£´Á¥Ñ¬•900' }
              },
              { time: '09:30', type: 'flight', title: 'ÊùæÂ±±Ê©üÂ†¥ (MYJ)', sub: 'Ëæ¶ÁêÜÁôªÊ©ü', img: 'ÊùæÂ±±Ê©üÂ†¥', imgUrl: getWikiImage('Matsuyama_Airport_(MYJ)_2.jpg'), icon: Plane, mapUrl: 'https://maps.app.goo.gl/paqfDDdpDyWFEZ7K6' },
              { time: '11:20', type: 'flight', title: 'È£õÂæÄÊ°ÉÂúí', sub: 'EVA Air BR 109', icon: Plane },
              { time: '13:05', type: 'home', title: 'ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥', sub: 'Ê∫´ÊöñÁöÑÂÆ∂', icon: MapPin },
            ]
          },
        ];

        // --- ÂÖÉ‰ª∂ÂçÄ ---

        const WeatherIcon = ({ condition, className }) => {
            if (condition === 'sunny') return <Sun className={`text-yellow-500 ${className}`} />;
            if (condition === 'cloudy') return <Cloud className={`text-gray-400 ${className}`} />;
            if (condition === 'rain') return <CloudRain className={`text-blue-400 ${className}`} />;
            return <Sun className={className} />;
        };

        const RealImage = ({ src, alt, fallbackText, height = "h-40" }) => {
            const [error, setError] = useState(false);
            if (error || !src) {
                return (
                    <div className={`w-full ${height} bg-gray-200 rounded-lg overflow-hidden relative group shadow-sm flex items-center justify-center`}>
                        <div className="text-gray-400 flex flex-col items-center">
                            <ImageIcon className="w-8 h-8 mb-2 opacity-50" />
                            <span className="text-xs font-bold text-gray-500 tracking-wide">{fallbackText}</span>
                        </div>
                    </div>
                );
            }
            return (
                <div className={`w-full ${height} bg-gray-100 rounded-lg overflow-hidden relative group shadow-sm`}>
                    <img src={src} alt={alt} onError={() => setError(true)} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-3">
                        <span className="text-white font-bold text-sm drop-shadow-md tracking-wide">{alt}</span>
                    </div>
                </div>
            );
        };

        const getWeatherCondition = (code) => {
          if (code === 0) return { condition: 'sunny', desc: 'Êô¥ÊúóÁÑ°Èõ≤' };
          if ([1, 2, 3].includes(code)) return { condition: 'cloudy', desc: 'Â§öÈõ≤' };
          if ([45, 48].includes(code)) return { condition: 'cloudy', desc: 'ÊúâÈúß' };
          if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) return { condition: 'rain', desc: 'ÊúâÈõ®' };
          return { condition: 'cloudy', desc: 'Â§öÈõ≤' };
        };

        const App = () => {
          const [activeDay, setActiveDay] = useState(1);
          const [currentWeather, setCurrentWeather] = useState(weatherData);
          const [isLiveWeather, setIsLiveWeather] = useState(false);
          const [loadingWeather, setLoadingWeather] = useState(true);

          useEffect(() => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }, [activeDay]);

          useEffect(() => {
            const fetchWeather = async () => {
              setLoadingWeather(true);
              const newWeatherData = { ...weatherData };
              let hasLiveData = false;
              const today = new Date();
              const currentYear = today.getFullYear();
              
              const promises = itinerary.map(async (dayItem) => {
                try {
                  const [month, day] = dayItem.date.split('/').map(Number);
                  const year = (today.getMonth() + 1 === 12 && month === 1) ? currentYear + 1 : currentYear;
                  const targetDate = new Date(year, month - 1, day);
                  const diffTime = targetDate - today;
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                  if (diffDays >= -1 && diffDays <= 15) {
                    const dateStr = targetDate.toISOString().split('T')[0];
                    const response = await fetch(
                      `https://api.open-meteo.com/v1/forecast?latitude=${dayItem.lat}&longitude=${dayItem.lng}&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${dateStr}&end_date=${dateStr}`
                    );
                    
                    if (!response.ok) throw new Error('API Error');
                    
                    const data = await response.json();
                    if (data.daily && data.daily.weather_code) {
                      const code = data.daily.weather_code[0];
                      const min = Math.round(data.daily.temperature_2m_min[0]);
                      const max = Math.round(data.daily.temperature_2m_max[0]);
                      const { condition, desc } = getWeatherCondition(code);
                      
                      newWeatherData[dayItem.day] = {
                        temp: `${min}¬∞C - ${max}¬∞C`,
                        condition: condition,
                        desc: `${desc} (Âç≥ÊôÇÈ†êÂ†±)`
                      };
                      hasLiveData = true;
                    }
                  }
                } catch (err) {}
              });

              await Promise.all(promises);
              setCurrentWeather(newWeatherData);
              setIsLiveWeather(hasLiveData);
              setLoadingWeather(false);
            };

            fetchWeather();
          }, []);

          const currentDayData = itinerary.find(d => d.day === activeDay);
          const weather = currentWeather[activeDay];

          return (
            <div className="min-h-screen text-slate-800 font-sans pb-20 max-w-md mx-auto shadow-2xl overflow-hidden relative border-x border-gray-100 bg-[#FFFBF5]">
              
              {/* Header */}
              <div className={`relative px-6 pt-12 pb-8 rounded-b-[40px] shadow-lg bg-gradient-to-br ${currentDayData.color} text-white transition-all duration-500`}>
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h2 className="text-sm font-medium opacity-90 tracking-widest uppercase">Japan Trip 2026</h2>
                    <h1 className="text-3xl font-bold mt-1">ÁÄ®Êà∂ÂÖßÊµ∑Á¥ÄË°å</h1>
                  </div>
                  <div className="bg-white/20 backdrop-blur-md rounded-xl p-2 px-3 text-center">
                    <div className="text-xs font-medium">DAY</div>
                    <div className="text-2xl font-bold leading-none">{activeDay}</div>
                  </div>
                </div>

                <div className="flex items-center space-x-2 text-white/90 text-sm font-medium mb-6">
                  <Calendar className="w-4 h-4" />
                  <span>{currentDayData.displayDate}</span>
                  <span>‚Ä¢</span>
                  <span>{currentDayData.location}</span>
                </div>

                {/* Weather Card */}
                <div className="bg-white/90 backdrop-blur-sm text-slate-700 rounded-2xl p-4 flex items-center justify-between shadow-lg transform translate-y-2">
                  <div className="flex items-center gap-3">
                    <div className="bg-blue-50 p-2 rounded-full relative">
                       {loadingWeather ? (
                         <div className="w-8 h-8 rounded-full border-2 border-blue-200 border-t-blue-500 animate-spin"></div>
                       ) : (
                         <WeatherIcon condition={weather.condition} className="w-8 h-8" />
                       )}
                    </div>
                    <div>
                      <div className="flex items-center gap-1">
                        <div className="text-xs text-gray-500 uppercase font-bold">Weather</div>
                        {isLiveWeather && !loadingWeather && weather.desc.includes('Âç≥ÊôÇ') && (
                          <span className="flex items-center gap-0.5 text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full font-bold">
                            <Wifi className="w-3 h-3" /> LIVE
                          </span>
                        )}
                      </div>
                      <div className="font-bold text-lg">
                        {loadingWeather ? 'Loading...' : weather.temp}
                      </div>
                    </div>
                  </div>
                  <div className="text-right max-w-[50%]">
                     <div className="text-sm font-medium leading-tight">
                       {loadingWeather ? 'Êõ¥Êñ∞Ê∞£Ë±°‰∏≠...' : weather.desc}
                     </div>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="px-5 pt-8 space-y-8">
                {/* Day Summary */}
                <div className="space-y-2">
                  <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <Info className="w-5 h-5 text-orange-400" />
                    ‰ªäÊó•ÈáçÈªû
                  </h3>
                  <p className="text-gray-600 leading-relaxed bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    {currentDayData.summary}
                  </p>
                </div>

                {/* Timeline */}
                <div className="space-y-0">
                  <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <Clock className="w-5 h-5 text-orange-400" />
                    Ë°åÁ®ãÊôÇÈñìËª∏
                  </h3>
                  <div className="relative pl-4 border-l-2 border-gray-200 space-y-8">
                    {currentDayData.schedule.map((item, idx) => (
                      <div key={idx} className="relative pl-6 group">
                        <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm transition-colors duration-300
                          ${item.type === 'food' ? 'bg-orange-400' : 
                            item.type === 'hotel' ? 'bg-purple-500' : 
                            item.type === 'transport' || item.type === 'move' ? 'bg-blue-400' : 'bg-emerald-500'}`} 
                        />
                        <div className="flex flex-col gap-2">
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <span className="text-sm font-bold text-gray-400 font-mono">{item.time}</span>
                              <div className="flex items-center gap-2">
                                <h4 className={`text-lg font-bold leading-snug ${item.mapUrl ? 'text-blue-700' : 'text-gray-800'}`}>
                                  {item.mapUrl ? (
                                    <a href={item.mapUrl} target="_blank" rel="noopener noreferrer" className="hover:underline decoration-blue-400 underline-offset-4">
                                      {item.title}
                                    </a>
                                  ) : item.title}
                                </h4>
                                {item.mapUrl && (
                                  <a href={item.mapUrl} target="_blank" rel="noopener noreferrer" className="bg-blue-100 text-blue-600 p-1 rounded-full hover:bg-blue-200 tap-active">
                                    <Navigation className="w-3 h-3" />
                                  </a>
                                )}
                              </div>
                              <p className="text-sm text-gray-500 font-medium">{item.sub}</p>
                            </div>
                            <item.icon className={`w-5 h-5 opacity-40 ${item.type === 'food' ? 'text-orange-500' : 'text-gray-500'}`} />
                          </div>

                          {/* ‰∫§ÈÄöË≥áË®äÂç°Áâá */}
                          {item.transport && (
                            <div className="bg-slate-50 border border-slate-200 rounded-lg p-2 text-xs text-slate-600 flex flex-wrap gap-y-1 gap-x-3 mt-1 items-center">
                                <div className="flex items-center gap-1">
                                    <Navigation className="w-3 h-3 text-blue-500" /> 
                                    <span>{item.transport.dist}</span>
                                </div>
                                <div className="flex items-center gap-1">
                                    <Timer className="w-3 h-3 text-orange-500" />
                                    <span>{item.transport.time}</span>
                                </div>
                                <div className="flex items-center gap-1">
                                    <Banknote className="w-3 h-3 text-green-600" />
                                    <span>{item.transport.cost}</span>
                                </div>
                            </div>
                          )}

                          {item.img && (
                            <div className="mt-1">
                              {item.mapUrl ? (
                                <a href={item.mapUrl} target="_blank" rel="noopener noreferrer" className="block tap-active">
                                    <RealImage src={item.imgUrl} alt={item.img} fallbackText={item.img} height="h-32" />
                                </a>
                              ) : (
                                <RealImage src={item.imgUrl} alt={item.img} fallbackText={item.img} height="h-32" />
                              )}
                            </div>
                          )}
                          {item.note && (
                            <div className="bg-yellow-50 text-yellow-800 text-xs p-2 rounded-lg border border-yellow-100 mt-1 flex gap-2 items-start">
                              <div className="mt-0.5">üí°</div>
                              <div>{item.note}</div>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="h-20"></div>
              </div>

              {/* Bottom Nav */}
              <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-md border-t border-gray-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] px-2 py-3 z-50">
                <div className="flex overflow-x-auto no-scrollbar gap-2 px-2 snap-x" style={{scrollbarWidth: 'none'}}>
                  {itinerary.map((d) => (
                    <button
                      key={d.day}
                      onClick={() => setActiveDay(d.day)}
                      className={`flex flex-col items-center justify-center min-w-[3.5rem] h-14 rounded-2xl transition-all duration-300 snap-center
                        ${activeDay === d.day 
                          ? 'bg-slate-800 text-white shadow-lg scale-105' 
                          : 'bg-gray-50 text-gray-400 hover:bg-gray-100'}`}
                    >
                      <span className="text-[10px] font-bold tracking-wider">DAY</span>
                      <span className="text-lg font-bold leading-none">{d.day}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

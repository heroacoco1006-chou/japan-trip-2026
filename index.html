<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÁÄ®Êà∂ÂÖßÊµ∑‰πãÊóÖ">
    <title>Êó•Êú¨ÊùæÂ±±Âª£Â≥∂‰πãÊóÖ</title>
    
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ÂºïÂÖ• Babel Áî®ÊñºËß£Êûê JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Ë®≠ÂÆö Import Map ‰ª•‰æøÁõ¥Êé•‰ΩøÁî® React Âíå Lucide -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <style>
        /* Èö±ËóèÊç≤Ëª∏‰ΩÜ‰øùÊåÅÂäüËÉΩ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body {
            -webkit-tap-highlight-color: transparent;
            touch-action: pan-y;
        }
    </style>
</head>
<body class="bg-[#FFFBF5]">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Plane, Car, MapPin, Utensils, Bed, Calendar, Sun, Cloud, 
            CloudRain, Ship, Coffee, Camera, Clock, Info, Image as ImageIcon, Wifi 
        } from 'lucide-react';

        // --- ÈÄôË£°ÈñãÂßãÊòØ App ÁöÑÈÇèËºØ ---

        const weatherData = {
            1: { temp: '6¬∞C - 11¬∞C', condition: 'sunny', desc: 'Êô¥ÊúóÔºåÊµ∑È¢®Á®çÂ§ß (Ê≠∑Âè≤Âπ≥Âùá)' },
            2: { temp: '5¬∞C - 10¬∞C', condition: 'cloudy', desc: 'Â§öÈõ≤ÔºåÈÅ©ÂêàÊ≠•Ë°å (Ê≠∑Âè≤Âπ≥Âùá)' },
            3: { temp: '4¬∞C - 9¬∞C', condition: 'rain', desc: 'ÂÅ∂ÊúâÂ∞èÈõ®ÔºåÂ∏∂ÂÇò (Ê≠∑Âè≤Âπ≥Âùá)' },
            4: { temp: '3¬∞C - 8¬∞C', condition: 'sunny', desc: 'Êô¥ÊúóÔºåÂÆÆÂ≥∂Â§ïÈôΩÁæé (Ê≠∑Âè≤Âπ≥Âùá)' },
            5: { temp: '4¬∞C - 10¬∞C', condition: 'cloudy', desc: 'Â§öÈõ≤ËΩâÊô¥ (Ê≠∑Âè≤Âπ≥Âùá)' },
            6: { temp: '5¬∞C - 11¬∞C', condition: 'sunny', desc: 'Êµ∑Ë±°Âπ≥Á©© (Ê≠∑Âè≤Âπ≥Âùá)' },
            7: { temp: '6¬∞C - 12¬∞C', condition: 'sunny', desc: 'Ê∫´ÊöñËàíÈÅ© (Ê≠∑Âè≤Âπ≥Âùá)' },
            8: { temp: '5¬∞C - 11¬∞C', condition: 'cloudy', desc: 'ÂõûÁ®ãÈ†ÜÂà© (Ê≠∑Âè≤Âπ≥Âùá)' },
        };

        const getWikiImage = (filename) => `https://commons.wikimedia.org/wiki/Special:FilePath/${filename}`;

        const itinerary = [
          {
            day: 1,
            date: '01/15',
            displayDate: '01/15 (Âõõ)',
            location: 'ÊÑõÂ™õÊùæÂ±± -> Â∞æÈÅì',
            lat: 34.4063, lng: 133.1950,
            summary: 'ÁÄ®Êà∂ÂÖßÊµ∑Ëá™ÈßïÈñãÂßã',
            color: 'from-orange-400 to-pink-500',
            schedule: [
              { time: '09:50', type: 'flight', title: 'ÊäµÈÅîÊùæÂ±±Ê©üÂ†¥', sub: 'EVA Air BR 110', icon: Plane, imgUrl: getWikiImage('Matsuyama_Airport_(MYJ)_2.jpg') },
              { time: '11:00', type: 'transport', title: 'ÂèñËªäÂá∫Áôº', sub: 'Ê™¢Êü•ËªäÊ≥Å„ÄÅË®≠ÂÆöÂ∞éËà™', icon: Car },
              { time: '12:30', type: 'food', title: '‰æÜÂ≥∂Êµ∑Â≥Ω SA', sub: 'ÂçàÈ§ê & ËßÄË≥û‰æÜÂ≥∂Êµ∑Â≥ΩÂ§ßÊ©ã', img: '‰æÜÂ≥∂Êµ∑Â≥ΩÂ§ßÊ©ã', imgUrl: getWikiImage('Kurushima-Kaikyo_Bridge_from_Oshima.jpg'), note: 'Êé®Ëñ¶ÔºöÁáíË±öÁéâÂ≠êÈ£Ø', icon: Utensils },
              { time: '15:00', type: 'activity', title: 'ÂæåËó§È£≤ÊñôÊ∞¥Â∑•Ê•≠ÊâÄ', sub: 'Âæ©Âè§ÂΩàÁè†Ê±ΩÊ∞¥', img: 'ÂæåËó§È£≤Êñô', imgUrl: getWikiImage('Ramune_drink.jpg'), icon: Coffee },
              { time: '16:00', type: 'activity', title: 'Â∞æÈÅìÊú¨ÈÄöÂïÜÂ∫óË°ó', sub: 'Ë≤ì‰πãÁ¥∞ÈÅì„ÄÅÊï£Á≠ñ', img: 'Â∞æÈÅìÂïÜÂ∫óË°ó', imgUrl: getWikiImage('Onomichi.JPG'), icon: MapPin },
              { time: '18:30', type: 'food', title: 'Â∞æÈÅìÊãâÈ∫µ', sub: 'ÊôöÈ§ê', img: 'Â∞æÈÅìÊãâÈ∫µ', imgUrl: getWikiImage('Onomichi_ramen.jpg'), note: 'ËÉåËÑÇÈÜ¨Ê≤πÊπØÂ∫ïÔºåÁÜ±È®∞È®∞ÔºÅ', icon: Utensils },
              { time: '20:00', type: 'hotel', title: '„Åï„Åè„Çâ„Åó„Åæ„Å™„Åø„Éõ„ÉÜ„É´Â∞æÈÅìÈßÖÂâç', sub: 'Check-in', img: 'Â∞æÈÅìÈ£ØÂ∫ó', imgUrl: getWikiImage('Onomichi_Station_2019.jpg'), icon: Bed },
            ]
          },
          {
            day: 2,
            date: '01/16',
            displayDate: '01/16 (‰∫î)',
            location: 'Â∞æÈÅì -> Âª£Â≥∂',
            lat: 34.3853, lng: 132.4553,
            summary: 'ÂçÉÂÖâÂØ∫ÂèÉÊãúËàáÂª£Â≥∂‰πãÂ§ú',
            color: 'from-blue-400 to-indigo-500',
            schedule: [
              { time: '09:00', type: 'activity', title: 'ÂçÉÂÖâÂØ∫ÂÖ¨Âúí', sub: 'Êê≠‰πòÁ∫úËªäÁôªÈ†Ç', img: 'ÂçÉÂÖâÂØ∫Á∫úËªä', imgUrl: getWikiImage('Onomichi_from_Senko-ji.jpg'), note: '‰øØÁû∞ÁÄ®Êà∂ÂÖßÊµ∑ÁµïÊôØ', icon: Camera },
              { time: '11:00', type: 'activity', title: 'ÂçÉÂÖâÂØ∫', sub: 'ÂØ∫ÂªüÈÅäË¶Ω„ÄÅÊ±ÇÂæ°ÂÆà', icon: MapPin },
              { time: '13:00', type: 'transport', title: 'ÂâçÂæÄÂª£Â≥∂Â∏Ç', sub: 'ËªäÁ®ãÁ¥Ñ 1.5 Â∞èÊôÇ', icon: Car },
              { time: '15:00', type: 'hotel', title: 'HOTEL MYSTAYS Âª£Â≥∂ÂíåÂπ≥ÂÖ¨ÂúíÂâç', sub: 'Check-in ÊîæÁΩÆË°åÊùé', img: 'Âª£Â≥∂È£ØÂ∫ó', imgUrl: getWikiImage('Hiroshima_City_View.jpg'), icon: Bed },
              { time: '16:30', type: 'activity', title: 'Âª£Â≥∂Êú¨ÈÄöÂïÜÂ∫óË°ó', sub: 'Â∏ÇÂçÄÈÄõË°óË≥ºÁâ©', img: 'Âª£Â≥∂Êú¨ÈÄö', imgUrl: getWikiImage('Hondori_Hiroshima.jpg'), icon: MapPin },
              { time: '19:00', type: 'food', title: 'Âª£Â≥∂Â∏ÇÂçÄÊôöÈ§ê', sub: 'Ëá™Áî±Êé¢Á¥¢', icon: Utensils },
            ]
          },
          {
            day: 3,
            date: '01/17',
            displayDate: '01/17 (ÂÖ≠)',
            location: 'Âª£Â≥∂Â∏ÇÂçÄ',
            lat: 34.3853, lng: 132.4553,
            summary: 'Ê≠∑Âè≤Â∑°Á¶ÆËàáÂª£Â≥∂Ááí',
            color: 'from-emerald-500 to-teal-600',
            schedule: [
              { time: '09:30', type: 'activity', title: 'ÂéüÁàÜÂúìÈ†ÇÈ§®', sub: '‰∏ñÁïåÈÅ∫Áî¢', img: 'ÂéüÁàÜÂúìÈ†ÇÈ§®', imgUrl: getWikiImage('Atomic_Bomb_Dome_-_panoramio.jpg'), icon: MapPin },
              { time: '10:30', type: 'activity', title: 'Âª£Â≥∂ÂíåÂπ≥Á¥ÄÂøµÂÖ¨Âúí', sub: 'ÂèÉËßÄË≥áÊñôÈ§®', icon: MapPin },
              { time: '12:30', type: 'food', title: 'Èï∑Áî∞Â±ã Âª£Â≥∂Ááí', sub: '‰∫∫Ê∞£ÊéíÈöäÂêçÂ∫ó', img: 'Èï∑Áî∞Â±ãÂª£Â≥∂Ááí', imgUrl: getWikiImage('Okonomiyaki_in_Hiroshima_style_(5808057511).jpg'), note: 'Â§ßÈáèÁöÑËî•ËàáÁâπË£ΩÈÜ¨Ê±Å', icon: Utensils },
              { time: '14:30', type: 'activity', title: 'Âª£Â≥∂Âüé', sub: 'ÈØâÈ≠öÂüé„ÄÅÂ§©ÂÆàÈñ£', img: 'Âª£Â≥∂Âüé', imgUrl: getWikiImage('Hiroshima_Castle.jpg'), icon: Camera },
              { time: '18:00', type: 'food', title: 'ÁÉ§Áâ°Ë†£Â∞èÂ±ã', sub: 'ÊôöÈ§ê', img: 'ÁÉ§Áâ°Ë†£', imgUrl: getWikiImage('Grilled_oysters_-_Food_in_Miyajima_-_DSC02187.JPG'), note: 'Âª£Â≥∂ÂêçÁî¢ÔºåÈÆÆÁæéÂ§öÊ±Å', icon: Utensils },
              { time: '20:00', type: 'hotel', title: 'HOTEL MYSTAYS Âª£Â≥∂ÂíåÂπ≥ÂÖ¨ÂúíÂâç', sub: '‰ºëÊÅØ', icon: Bed },
            ]
          },
          {
            day: 4,
            date: '01/18',
            displayDate: '01/18 (Êó•)',
            location: 'Âª£Â≥∂ -> ÂÆÆÂ≥∂',
            lat: 34.2960, lng: 132.3199,
            summary: 'Á•û‰πãÂ≥∂ËàáÊµ∑‰∏äÈ≥•Â±Ö',
            color: 'from-red-500 to-orange-500',
            schedule: [
              { time: '09:30', type: 'transport', title: 'ÂâçÂæÄÂÆÆÂ≥∂Âè£', sub: 'Êê≠‰πòÊ∏°Ëº™ (‰∫∫+Ëªä)', img: 'ÂÆÆÂ≥∂Ê∏°Ëº™', imgUrl: getWikiImage('Miyajima_ferry_(15711785199).jpg'), icon: Ship },
              { time: '11:00', type: 'activity', title: 'Âö¥Â≥∂Á•ûÁ§æ', sub: 'Êµ∑‰∏äÂ§ßÈ≥•Â±Ö', img: 'Âö¥Â≥∂Á•ûÁ§æÈ≥•Â±Ö', imgUrl: getWikiImage('Itsukushima_torii_angle.jpg'), icon: Camera },
              { time: '12:30', type: 'food', title: 'ÂÆÆÂ≥∂ÂïÜÂ∫óË°ó', sub: 'ÂçàÈ§ê', img: 'ÂÆÆÂ≥∂ÂïÜÂ∫óË°ó', imgUrl: getWikiImage('Miyajima_Omotesando.jpg'), note: 'Êé®Ëñ¶ÔºöÁÇ∏Á¥ÖËëâÈ•ÖÈ†≠„ÄÅÁ©¥Â≠êÈ£Ø', icon: Utensils },
              { time: '14:30', type: 'activity', title: 'Ë°®ÂèÉÈÅìÂïÜÂ∫óË°ó', sub: 'Êï£Ê≠•„ÄÅË≤∑‰º¥ÊâãÁ¶Æ', icon: MapPin },
              { time: '17:30', type: 'hotel', title: 'ÂÆÆÂ≥∂ Á•ûÊí∞‰πãÂÆø Hotel Miya Rikyu', sub: 'Check-in', img: 'ÂÆÆÂ≥∂Ê∫´Ê≥âÈ£ØÂ∫ó', imgUrl: getWikiImage('Miyajima_ryokan.jpg'), note: '‰∫´ÂèóÊ∫´Ê≥âËàáÊá∑Áü≥ÊñôÁêÜ', icon: Bed },
              { time: '18:30', type: 'food', title: 'Ê∫´Ê≥âÈ£ØÂ∫óÊôöÈ§ê', sub: 'Ë±™ËèØÊúÉÂ∏≠ÊñôÁêÜ', icon: Utensils },
            ]
          },
          {
            day: 5,
            date: '01/19',
            displayDate: '01/19 (‰∏Ä)',
            location: 'ÂÆÆÂ≥∂ -> Âê≥Â∏Ç',
            lat: 34.2483, lng: 132.5656,
            summary: 'Êµ∑ËªçÊ∏ØÂè£ËàáÊΩõÊ∞¥Ëâá',
            color: 'from-slate-600 to-slate-800',
            schedule: [
              { time: '09:00', type: 'activity', title: 'ÂÆÆÂ≥∂Á∫úËªä', sub: 'Á¥ÖËëâË∞∑ÂÖ¨ÂúíÁ´ô', img: 'ÂÆÆÂ≥∂Á∫úËªäÈ¢®ÊôØ', imgUrl: getWikiImage('Miyajima_View.jpg'), icon: Camera },
              { time: '13:00', type: 'transport', title: 'ÂâçÂæÄÂê≥Â∏Ç', sub: 'ËªäÁ®ãÁ¥Ñ 1 Â∞èÊôÇ', icon: Car },
              { time: '14:00', type: 'food', title: 'Êµ∑ËªçÂíñÂì©', sub: 'ÂçàÈ§ê', img: 'Êµ∑ËªçÂíñÂì©', imgUrl: getWikiImage('Curry_Japanese_Navy_Cookbook_1908.png'), note: 'È´îÈ©óËàäÊó•Êú¨Êµ∑ËªçÁöÑÂë≥ÈÅì', icon: Utensils },
              { time: '15:00', type: 'activity', title: 'ÈêµÈØ®È§®', sub: 'Êµ∑‰∏äËá™Ë°õÈöäÂê≥Âè≤ÊñôÈ§®', img: 'ÈêµÈØ®È§®ÊΩõÊ∞¥Ëâá', imgUrl: getWikiImage('JMSDF_Kure_Museum.jpg'), note: 'ÂèØÈÄ≤ÂÖ•ÁúüÂØ¶ÊΩõÊ∞¥ËâáÂÖßÈÉ®', icon: MapPin },
              { time: '17:00', type: 'activity', title: 'Âê≥ÁÅ£Ëâ¶ËàπÂ∑°ÈÅä', sub: 'Â§ïÈôΩÁâàÂ∞éË¶Ω', img: 'Âê≥Â∏ÇËªçËâ¶', imgUrl: getWikiImage('JMSDF_Kure_Base_E_wharf.jpg'), note: 'ËøëË∑ùÈõ¢ËßÄÁúãË≠∑Ë°õËâ¶', icon: Ship },
              { time: '19:00', type: 'food', title: 'Âê≥Â∏ÇÂ±ãÂè∞ (Ëµ§ÊèêÁáà)', sub: 'ÊôöÈ§ê', img: 'Âê≥Â∏ÇÂ±ãÂè∞', imgUrl: getWikiImage('Oden_yatai.jpg'), note: 'Ë∑ØÈÇäÊî§Ê∞õÂúç', icon: Utensils },
              { time: '20:30', type: 'hotel', title: 'Comfort Hotel Âê≥', sub: 'Check-in', img: 'Âê≥Â∏ÇÈ£ØÂ∫ó', imgUrl: getWikiImage('Kure_City_View.jpg'), icon: Bed },
            ]
          },
          {
            day: 6,
            date: '01/20',
            displayDate: '01/20 (‰∫å)',
            location: 'Âê≥Â∏Ç -> ÊùæÂ±±',
            lat: 33.8392, lng: 132.7655,
            summary: 'Ê©´Ê∏°ÁÄ®Êà∂ÂÖßÊµ∑',
            color: 'from-cyan-500 to-blue-600',
            schedule: [
              { time: '09:30', type: 'transport', title: 'ÁÄ®Êà∂ÂÖßÊµ∑Ê±ΩËàπ', sub: 'Âê≥Ê∏Ø -> ÊùæÂ±±ËßÄÂÖâÊ∏Ø', img: 'ÁÄ®Êà∂ÂÖßÊµ∑Ê±ΩËàπ', imgUrl: getWikiImage('Miyajima_Maru_ferry.jpg'), note: 'ËªäËºõ‰∏ÄÂêå‰∏äËàπÔºåÁ¥Ñ2Â∞èÊôÇ', icon: Ship },
              { time: '11:30', type: 'food', title: 'Ëàπ‰∏äÂ∞èË≥£ÈÉ®', sub: 'ÂçàÈ§ê', note: 'Á∞°ÂñÆÁÉèÈæçÈ∫µÊàñ‰æøÁï∂', icon: Utensils },
              { time: '13:30', type: 'activity', title: 'ÊÑõÂ™õÁ∏£Á´ãÁ†•ÈÉ®ÂãïÁâ©Âúí', sub: 'ËàáÁôΩÁÜäÂíåÂπ≥Áõ∏Ëôï', img: 'Á†•ÈÉ®ÂãïÁâ©Âúí', imgUrl: getWikiImage('Tobe_zoo2.jpg'), icon: Camera },
              { time: '18:00', type: 'food', title: 'ÈÑâÂúüÊñôÁêÜ ‰∫îÂøóÂñú', sub: 'ÊôöÈ§êÔºöÈØõÈ≠öÁ¥∞È∫µ', img: 'ÈØõÈ≠öÁ¥∞È∫µ', imgUrl: getWikiImage('Somen_001.jpg'), note: 'ÊÑõÂ™õÁ∏£‰ª£Ë°®ÊÄßÁæéÈ£ü', icon: Utensils },
              { time: '20:00', type: 'hotel', title: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖßÈ£ØÂ∫ó', sub: 'Check-in', img: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖß', imgUrl: getWikiImage('Matsuyama_City_Station.jpg'), icon: Bed },
            ]
          },
          {
            day: 7,
            date: '01/21',
            displayDate: '01/21 (‰∏â)',
            location: 'ÊùæÂ±±Â∏ÇÂçÄ',
            lat: 33.8392, lng: 132.7655,
            summary: 'Âè§ÂüéËàáÂçÉÂπ¥Ê∫´Ê≥â',
            color: 'from-orange-500 to-amber-500',
            schedule: [
              { time: '09:30', type: 'activity', title: 'ÊùæÂ±±Âüé', sub: 'Êê≠‰πòÁ∫úËªä/ÂêäÊ§Ö', img: 'ÊùæÂ±±Âüé', imgUrl: getWikiImage('Matsuyama_Castle_ÊùæÂ±±Âüé_-_panoramio_(3).jpg'), note: 'ÁèæÂ≠ò12Â§©ÂÆà‰πã‰∏Ä', icon: Camera },
              { time: '12:00', type: 'food', title: 'ÊùæÂ±±ÈØõÈ≠öÈ£Ø', sub: 'ÂçàÈ§ê', img: 'ÈØõÈ≠öÈ£Ø', imgUrl: getWikiImage('Tai-meshi.jpg'), icon: Utensils },
              { time: '14:00', type: 'activity', title: 'ÈÅìÂæåÊ∫´Ê≥âÊú¨È§®', sub: 'Á•ûÈö±Â∞ëÂ•≥Â†¥ÊôØ', img: 'ÈÅìÂæåÊ∫´Ê≥â', imgUrl: getWikiImage('Dogo-onsen_Honkan.jpg'), icon: MapPin },
              { time: '15:30', type: 'activity', title: 'ÈÅìÂæåÂïÜÂ∫óË°ó', sub: 'Â∞ëÁà∫Ê©üÈóúÈêò', note: 'Ë≥ºË≤∑ÊÑõÂ™õÊ©òÂ≠êÂë®ÈÇä', icon: MapPin },
              { time: '18:00', type: 'food', title: 'ÈÅìÂæåÊ∫´Ê≥âË°óÊôöÈ§ê', sub: 'Ëá™Áî±Ë¶ìÈ£ü', icon: Utensils },
              { time: '20:00', type: 'hotel', title: 'ÊùæÂ±±Â§ßÂíåÈ≠ØÂÖßÈ£ØÂ∫ó', sub: 'Êï¥ÁêÜË°åÊùé', icon: Bed },
            ]
          },
          {
            day: 8,
            date: '01/22',
            displayDate: '01/22 (Âõõ)',
            location: 'ÊùæÂ±± -> Ê°ÉÂúí',
            lat: 33.8392, lng: 132.7655,
            summary: 'ÊªøËºâËÄåÊ≠∏',
            color: 'from-gray-500 to-gray-700',
            schedule: [
              { time: '08:30', type: 'hotel', title: 'Check-out', sub: 'È£ØÂ∫óÈÄÄÊàø', icon: Bed },
              { time: '09:00', type: 'transport', title: 'ÂâçÂæÄÊùæÂ±±Ê©üÂ†¥', sub: 'ÈÇÑËªä', img: 'ÊùæÂ±±Ê©üÂ†¥', imgUrl: getWikiImage('Matsuyama_Airport_(MYJ)_2.jpg'), icon: Car },
              { time: '11:20', type: 'flight', title: 'È£õÂæÄÊ°ÉÂúí', sub: 'EVA Air BR 109', icon: Plane },
              { time: '13:05', type: 'home', title: 'ÊäµÈÅîÊ°ÉÂúíÊ©üÂ†¥', sub: 'Ê∫´ÊöñÁöÑÂÆ∂', icon: MapPin },
            ]
          },
        ];

        const WeatherIcon = ({ condition, className }) => {
            if (condition === 'sunny') return <Sun className={`text-yellow-500 ${className}`} />;
            if (condition === 'cloudy') return <Cloud className={`text-gray-400 ${className}`} />;
            if (condition === 'rain') return <CloudRain className={`text-blue-400 ${className}`} />;
            return <Sun className={className} />;
        };

        const RealImage = ({ src, alt, fallbackText, height = "h-40" }) => {
            const [error, setError] = useState(false);
            if (error || !src) {
                return (
                    <div className={`w-full ${height} bg-gray-200 rounded-lg overflow-hidden relative group shadow-sm flex items-center justify-center`}>
                        <div className="text-gray-400 flex flex-col items-center">
                            <ImageIcon className="w-8 h-8 mb-2 opacity-50" />
                            <span className="text-xs font-bold text-gray-500 tracking-wide">{fallbackText}</span>
                        </div>
                    </div>
                );
            }
            return (
                <div className={`w-full ${height} bg-gray-100 rounded-lg overflow-hidden relative group shadow-sm`}>
                    <img src={src} alt={alt} onError={() => setError(true)} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-3">
                        <span className="text-white font-bold text-sm drop-shadow-md tracking-wide">{alt}</span>
                    </div>
                </div>
            );
        };

        // WMO Â§©Ê∞£‰ª£Á¢ºËΩâÊèõ
        const getWeatherCondition = (code) => {
          if (code === 0) return { condition: 'sunny', desc: 'Êô¥ÊúóÁÑ°Èõ≤' };
          if ([1, 2, 3].includes(code)) return { condition: 'cloudy', desc: 'Â§öÈõ≤' };
          if ([45, 48].includes(code)) return { condition: 'cloudy', desc: 'ÊúâÈúß' };
          if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) return { condition: 'rain', desc: 'ÊúâÈõ®' };
          return { condition: 'cloudy', desc: 'Â§öÈõ≤' };
        };

        const App = () => {
          const [activeDay, setActiveDay] = useState(1);
          const [currentWeather, setCurrentWeather] = useState(weatherData);
          const [isLiveWeather, setIsLiveWeather] = useState(false);
          const [loadingWeather, setLoadingWeather] = useState(true);

          useEffect(() => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }, [activeDay]);

          useEffect(() => {
            const fetchWeather = async () => {
              setLoadingWeather(true);
              const newWeatherData = { ...weatherData };
              let hasLiveData = false;
              const today = new Date();
              const currentYear = today.getFullYear();
              
              const promises = itinerary.map(async (dayItem) => {
                try {
                  const [month, day] = dayItem.date.split('/').map(Number);
                  const year = (today.getMonth() + 1 === 12 && month === 1) ? currentYear + 1 : currentYear;
                  const targetDate = new Date(year, month - 1, day);
                  const diffTime = targetDate - today;
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                  if (diffDays >= -1 && diffDays <= 15) {
                    const dateStr = targetDate.toISOString().split('T')[0];
                    const response = await fetch(
                      `https://api.open-meteo.com/v1/forecast?latitude=${dayItem.lat}&longitude=${dayItem.lng}&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&start_date=${dateStr}&end_date=${dateStr}`
                    );
                    
                    if (!response.ok) throw new Error('API Error');
                    
                    const data = await response.json();
                    if (data.daily && data.daily.weather_code) {
                      const code = data.daily.weather_code[0];
                      const min = Math.round(data.daily.temperature_2m_min[0]);
                      const max = Math.round(data.daily.temperature_2m_max[0]);
                      const { condition, desc } = getWeatherCondition(code);
                      
                      newWeatherData[dayItem.day] = {
                        temp: `${min}¬∞C - ${max}¬∞C`,
                        condition: condition,
                        desc: `${desc} (Âç≥ÊôÇÈ†êÂ†±)`
                      };
                      hasLiveData = true;
                    }
                  }
                } catch (err) {}
              });

              await Promise.all(promises);
              setCurrentWeather(newWeatherData);
              setIsLiveWeather(hasLiveData);
              setLoadingWeather(false);
            };

            fetchWeather();
          }, []);

          const currentDayData = itinerary.find(d => d.day === activeDay);
          const weather = currentWeather[activeDay];

          return (
            <div className="min-h-screen text-slate-800 font-sans pb-20 max-w-md mx-auto shadow-2xl overflow-hidden relative border-x border-gray-100 bg-[#FFFBF5]">
              
              {/* Header */}
              <div className={`relative px-6 pt-12 pb-8 rounded-b-[40px] shadow-lg bg-gradient-to-br ${currentDayData.color} text-white transition-all duration-500`}>
                <div className="flex justify-between items-start mb-4">
                  <div>
                    <h2 className="text-sm font-medium opacity-90 tracking-widest uppercase">Japan Trip 2026</h2>
                    <h1 className="text-3xl font-bold mt-1">ÁÄ®Êà∂ÂÖßÊµ∑Á¥ÄË°å</h1>
                  </div>
                  <div className="bg-white/20 backdrop-blur-md rounded-xl p-2 px-3 text-center">
                    <div className="text-xs font-medium">DAY</div>
                    <div className="text-2xl font-bold leading-none">{activeDay}</div>
                  </div>
                </div>

                <div className="flex items-center space-x-2 text-white/90 text-sm font-medium mb-6">
                  <Calendar className="w-4 h-4" />
                  <span>{currentDayData.displayDate}</span>
                  <span>‚Ä¢</span>
                  <span>{currentDayData.location}</span>
                </div>

                {/* Weather Card */}
                <div className="bg-white/90 backdrop-blur-sm text-slate-700 rounded-2xl p-4 flex items-center justify-between shadow-lg transform translate-y-2">
                  <div className="flex items-center gap-3">
                    <div className="bg-blue-50 p-2 rounded-full relative">
                       {loadingWeather ? (
                         <div className="w-8 h-8 rounded-full border-2 border-blue-200 border-t-blue-500 animate-spin"></div>
                       ) : (
                         <WeatherIcon condition={weather.condition} className="w-8 h-8" />
                       )}
                    </div>
                    <div>
                      <div className="flex items-center gap-1">
                        <div className="text-xs text-gray-500 uppercase font-bold">Weather</div>
                        {isLiveWeather && !loadingWeather && weather.desc.includes('Âç≥ÊôÇ') && (
                          <span className="flex items-center gap-0.5 text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full font-bold">
                            <Wifi className="w-3 h-3" /> LIVE
                          </span>
                        )}
                      </div>
                      <div className="font-bold text-lg">
                        {loadingWeather ? 'Loading...' : weather.temp}
                      </div>
                    </div>
                  </div>
                  <div className="text-right max-w-[50%]">
                     <div className="text-sm font-medium leading-tight">
                       {loadingWeather ? 'Êõ¥Êñ∞Ê∞£Ë±°‰∏≠...' : weather.desc}
                     </div>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="px-5 pt-8 space-y-8">
                {/* Day Summary */}
                <div className="space-y-2">
                  <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <Info className="w-5 h-5 text-orange-400" />
                    ‰ªäÊó•ÈáçÈªû
                  </h3>
                  <p className="text-gray-600 leading-relaxed bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    {currentDayData.summary}
                  </p>
                </div>

                {/* Timeline */}
                <div className="space-y-0">
                  <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <Clock className="w-5 h-5 text-orange-400" />
                    Ë°åÁ®ãÊôÇÈñìËª∏
                  </h3>
                  <div className="relative pl-4 border-l-2 border-gray-200 space-y-8">
                    {currentDayData.schedule.map((item, idx) => (
                      <div key={idx} className="relative pl-6 group">
                        <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white shadow-sm transition-colors duration-300
                          ${item.type === 'food' ? 'bg-orange-400' : 
                            item.type === 'hotel' ? 'bg-purple-500' : 
                            item.type === 'transport' || item.type === 'flight' ? 'bg-blue-400' : 'bg-emerald-500'}`} 
                        />
                        <div className="flex flex-col gap-2">
                          <div className="flex justify-between items-start">
                            <div>
                              <span className="text-sm font-bold text-gray-400 font-mono">{item.time}</span>
                              <h4 className="text-lg font-bold text-gray-800 leading-snug">{item.title}</h4>
                              <p className="text-sm text-gray-500 font-medium">{item.sub}</p>
                            </div>
                            <item.icon className={`w-5 h-5 opacity-40 ${item.type === 'food' ? 'text-orange-500' : 'text-gray-500'}`} />
                          </div>
                          {item.img && (
                            <div className="mt-1">
                              <RealImage src={item.imgUrl} alt={item.img} fallbackText={item.img} height="h-32" />
                            </div>
                          )}
                          {item.note && (
                            <div className="bg-yellow-50 text-yellow-800 text-xs p-2 rounded-lg border border-yellow-100 mt-1 flex gap-2 items-start">
                              <div className="mt-0.5">üí°</div>
                              <div>{item.note}</div>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="h-20"></div>
              </div>

              {/* Bottom Nav */}
              <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/95 backdrop-blur-md border-t border-gray-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] px-2 py-3 z-50">
                <div className="flex overflow-x-auto no-scrollbar gap-2 px-2 snap-x" style={{scrollbarWidth: 'none'}}>
                  {itinerary.map((d) => (
                    <button
                      key={d.day}
                      onClick={() => setActiveDay(d.day)}
                      className={`flex flex-col items-center justify-center min-w-[3.5rem] h-14 rounded-2xl transition-all duration-300 snap-center
                        ${activeDay === d.day 
                          ? 'bg-slate-800 text-white shadow-lg scale-105' 
                          : 'bg-gray-50 text-gray-400 hover:bg-gray-100'}`}
                    >
                      <span className="text-[10px] font-bold tracking-wider">DAY</span>
                      <span className="text-lg font-bold leading-none">{d.day}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
